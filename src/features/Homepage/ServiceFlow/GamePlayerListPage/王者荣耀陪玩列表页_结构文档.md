# 🌳 王者荣耀陪玩列表页 结构指导文档 v2.1

> **页面名称：** 王者荣耀陪玩列表页
> **所属模块：** Game (游戏模块)
> **页面类型：** 列表页（带筛选 + 排序 + 快捷标签）

---

## 🚪 页面入口与导航上下文

### 入口路径

| 入口来源 | 来源页面位置 | 触发操作 | 路由参数 |
|----------|--------------|----------|----------|
| 游戏图标 | 首页 > 游戏分类区 > 王者荣耀 | 点击游戏图标 | `gameId=wzry` |
| 更多按钮 | 首页 > 限时专享 > 更多 | 点击"更多 >" | `gameId=wzry&source=featured` |
| 玩家卡片 | 首页 > 限时专享 > 用户卡片 | 点击卡片 | 跳转用户详情页（非本页） |

### 导航上下文

从首页进入时携带的数据：
- **位置信息**: 首页顶部显示的城市（深圳）→ 用于距离计算和同城筛选
- **定位坐标**: `latitude`, `longitude` → 计算"3.2km"距离显示
- **来源标识**: `source` 参数 → 数据埋点和行为分析

### 返回行为

| 操作 | 行为 |
|------|------|
| 点击返回按钮 | `router.back()` → 返回首页 |
| 系统返回手势 | 同上 |

---

## 📊 变更影响矩阵

> 用于评估需求变更时的影响范围，快速定位需要修改的STEP

### 常见变更场景

| 变更类型 | 影响STEP | 修改范围 | 工作量 |
|----------|----------|----------|--------|
| 新增筛选维度 | 1,2,3,4,5,6 | 全链路 | 大 |
| 新增排序方式 | 1,2,6 | 数据模型+流程+后端 | 中 |
| 修改卡片样式 | 3,4,5 | 树状图+布局+代码结构 | 中 |
| 修改卡片字段 | 1,3,6 | 数据模型+树状图+接口 | 中 |
| 新增快捷标签 | 1,6 | 数据模型+后端配置 | 小 |
| 修改布局样式 | 4,5 | 布局+代码结构 | 小 |
| 新增列表操作 | 1,2,3,6 | 数据+流程+组件+接口 | 中 |

### STEP依赖关系

```
STEP 1 (数据模型) ──────────────────────────────────────→ STEP 6 (接口)
    ↓                                                         ↑
STEP 2 (流程图) ─→ STEP 3 (树状图) ─→ STEP 4 (布局) ─→ STEP 5 (代码)
```

### 快速定位指南

| 我想了解... | 查看STEP |
|-------------|----------|
| 页面有哪些数据 | STEP 1 |
| 用户操作流程 | STEP 2 |
| 组件层级结构 | STEP 3 |
| UI布局尺寸 | STEP 4 |
| 文件目录结构 | STEP 5 |
| 接口和数据库 | STEP 6 |

---

## 📋 STEP 1: 页面数据模型（合并优化版）

### 设计理念

```
页面功能：展示王者荣耀游戏陪玩用户列表，支持多维度筛选、排序和快捷标签筛选
数据流向：
┌─────────────────────────────────────────────────────────────────┐
│  进入页面 → [API:getPlayerList] → 渲染列表                        │
│  排序切换 → [API:getPlayerList(sort)] → 替换列表                  │
│  性别筛选 → [API:getPlayerList(gender)] → 替换列表                │
│  筛选面板 → [API:getPlayerList(filters)] → 替换列表               │
│  快捷标签 → [API:getPlayerList(quickTag)] → 替换列表              │
│  点击用户 → 跳转用户详情页                                        │
└─────────────────────────────────────────────────────────────────┘
```

### PageModel

```json
{
  "模型信息": {
    "页面名称": "王者荣耀陪玩列表页",
    "页面标识": "GamePlayerListPage",
    "所属模块": "Game",
    "页面类型": "列表页"
  },

  "数据依赖图": "{FilterConfig} + {ListData} → 渲染页面 → 用户操作 → {ActionResult}",

  "PageModel": {
    "_说明": "页面级数据模型 [L1]",

    "HeaderData": {
      "_说明": "头部导航数据 → [→HeaderArea]",
      "title": "String - 页面标题 - [UI:HeaderArea.标题] - '王者荣耀'",
      "showBack": "Boolean - 是否显示返回按钮 - [UI:HeaderArea.返回按钮] - 固定true"
    },

    "FilterData": {
      "_说明": "筛选配置数据 → [→FilterBarArea]",
      "sortType": "String(smart|newest|recent|popular) - 排序类型 - [状态:控制列表排序]",
      "sortLabel": "String - 排序显示文案 - [UI:FilterBarArea.排序按钮]",
      "genderFilter": "String(all|female|male) - 性别筛选 - [状态:控制性别筛选]",
      "genderLabel": "String - 性别显示文案 - [UI:FilterBarArea.性别按钮]",
      "activeFilters": "Object - 已选筛选条件 - [状态:筛选面板已选项]",
      "filterCount": "Number - 已选筛选数量 - [UI:FilterBarArea.筛选角标] [条件:>0时显示]"
    },

    "QuickTagData": {
      "_说明": "快捷标签数据 → [→QuickTagArea]",
      "tags": "Array<QuickTagItem> - 标签列表 - [UI:QuickTagArea]",
      "currentTag": "String? - 当前选中标签 - [状态:控制列表筛选]"
    },

    "ListData": {
      "_说明": "陪玩用户列表数据 → [→ContentArea]",
      "list": "Array<PlayerItem> - 用户列表 - [UI:ContentArea]",
      "hasMore": "Boolean - 是否有更多 - [控制:加载更多/到底提示]",
      "total": "Number? - 总数 - [可选]"
    },

    "PageState": {
      "_说明": "页面状态数据",
      "isLoading": "Boolean - 加载中 - [状态:骨架屏/Loading]",
      "isRefreshing": "Boolean - 刷新中 - [状态:下拉刷新指示器]",
      "showSortDropdown": "Boolean - 显示排序下拉 - [状态:控制SortDropdown显示]",
      "showGenderDropdown": "Boolean - 显示性别下拉 - [状态:控制GenderDropdown显示]",
      "showFilterSheet": "Boolean - 显示筛选面板 - [状态:控制FilterSheet显示]",
      "isEmpty": "Boolean - 列表为空 - [状态:空状态]",
      "isError": "Boolean - 加载失败 - [状态:错误提示]",
      "errorMessage": "String? - 错误信息 - [UI:错误提示文案]"
    }
  }
}
```

### AreaModel

```json
{
  "AreaModel": {
    "_说明": "区域级数据模型 [L2]",

    "FilterBarArea": {
      "_说明": "筛选栏区域",
      "sortOptions": "Array<SortOption> - 排序选项列表",
      "SortOption": {
        "key": "String(smart|newest|recent|popular) - 排序标识",
        "label": "String - 排序文案 - 智能排序/最新排序/最近排序/人气排序",
        "isActive": "Boolean - 是否选中 - [状态:选中样式-紫色+勾]"
      },
      "genderOptions": "Array<GenderOption> - 性别选项列表",
      "GenderOption": {
        "key": "String(all|female|male) - 性别标识",
        "label": "String - 性别文案 - 不限性别/只看女生/只看男生",
        "isActive": "Boolean - 是否选中 - [状态:选中样式-紫色+勾]"
      }
    },

    "QuickTagArea": {
      "tags": "Array<QuickTagItem> - 快捷标签列表",
      "QuickTagItem": {
        "key": "String - 标签标识 - [用于:筛选参数]",
        "label": "String - 标签文案 - [UI:Tag.文字]",
        "isActive": "Boolean - 是否选中 - [状态:选中样式-紫色背景/紫色边框]"
      }
    },

    "FilterSheetArea": {
      "_说明": "筛选面板区域数据",
      "filterGroups": "Array<FilterGroup> - 筛选分组列表",
      "FilterGroup": {
        "groupKey": "String - 分组标识",
        "groupLabel": "String - 分组标题 - 状态/大区/段位/价格/位置/标签/所在地",
        "options": "Array<FilterOption> - 选项列表",
        "isMultiple": "Boolean - 是否多选"
      },
      "FilterOption": {
        "key": "String - 选项标识",
        "label": "String - 选项文案",
        "isActive": "Boolean - 是否选中 - [状态:选中样式-紫色背景/紫色边框]"
      }
    },

    "ContentArea": {
      "list": "Array<PlayerItem> - 陪玩用户列表",
      "layoutType": "String(list) - 布局类型 - 垂直列表"
    }
  }
}
```

### ItemModel

```json
{
  "ItemModel": {
    "_说明": "列表项数据模型 [L3]",

    "PlayerItem": {
      "_说明": "陪玩用户卡片数据 → [→PlayerItemComponent]",

      "userId": "String - 用户ID - [用于:跳转用户详情、操作参数]",

      "avatarData": {
        "_说明": "头像/媒体区域 → [→PlayerItem.媒体区]",
        "avatarUrl": "String - 头像/封面URL - [UI:卡片.头像] [样式:120x160圆角8px]",
        "isVideo": "Boolean? - 是否视频 - [条件:true时显示播放标识]"
      },

      "basicInfo": {
        "_说明": "基础信息区域 → [→PlayerItem.信息区]",
        "nickname": "String - 昵称 - [UI:卡片.昵称] [样式:16sp#333333粗体]",
        "gender": "String(male|female) - 性别 - [UI:卡片.性别图标] [male=♂蓝色,female=♀粉色]",
        "age": "Number - 年龄 - [UI:卡片.年龄] [格式:与性别组合显示]"
      },

      "certificationData": {
        "_说明": "认证信息 → [→PlayerItem.认证区]",
        "isVerified": "Boolean - 是否实名认证 - [UI:卡片.认证标签] [条件:true时显示'实名认证'标签]",
        "isExpert": "Boolean - 是否大神认证 - [UI:卡片.大神标签] [条件:true时显示'大神'标签]"
      },

      "skillData": {
        "_说明": "技能介绍 → [→PlayerItem.技能区]",
        "description": "String - 技能介绍 - [UI:卡片.介绍文本] [样式:14sp#666666,最多2行,省略]"
      },

      "gameTagData": {
        "_说明": "游戏标签 → [→PlayerItem.标签区]",
        "serverRegion": "String - 大区 - [UI:卡片.大区标签] - 微信区/QQ区",
        "rank": "String - 段位 - [UI:卡片.段位标签] - 荣耀王者",
        "peakScore": "String? - 巅峰分 - [UI:卡片.巅峰分标签] [条件:有值时显示] - 巅峰1800+"
      },

      "priceData": {
        "_说明": "价格信息 → [→PlayerItem.价格区]",
        "price": "Number - 单价 - [UI:卡片.价格数字] [样式:20sp#FF6B6B粗体]",
        "unit": "String - 单位 - [UI:卡片.价格单位] - 金币/局"
      },

      "locationData": {
        "_说明": "位置信息 → [→PlayerItem.位置区]",
        "distance": "String - 距离 - [UI:卡片.距离] [格式:X.Xkm] - 3.2km"
      }
    }
  }
}
```

### SharedModel

```json
{
  "SharedModel": {
    "_说明": "跨页面复用的数据模型 [L4]",

    "PaginationInfo": {
      "_说明": "分页信息",
      "page": "Number - 当前页码 - 默认1",
      "pageSize": "Number - 每页数量 - 默认20",
      "hasMore": "Boolean - 是否有更多",
      "total": "Number? - 总数"
    },

    "FilterConfig": {
      "_说明": "筛选配置",
      "gameId": "String - 游戏ID - 王者荣耀",
      "sortType": "String - 排序类型",
      "genderFilter": "String - 性别筛选",
      "quickTag": "String? - 快捷标签",
      "filters": "Object - 筛选条件对象"
    },

    "ActionResult": {
      "_说明": "操作结果",
      "success": "Boolean - 是否成功",
      "message": "String? - 提示信息"
    }
  }
}
```

### 数据模型汇总表

| 模型名 | 层级 | 对应组件 | 说明 |
|--------|------|----------|------|
| PageModel | L1 | GamePlayerListPage | 页面级数据，组合所有区域数据 |
| FilterData | L2 | FilterBarArea | 筛选栏数据（排序+性别+筛选） |
| QuickTagData | L2 | QuickTagArea | 快捷标签数据 |
| ListData | L2 | ContentArea | 陪玩用户列表数据 |
| FilterSheetArea | L2 | FilterSheet | 筛选面板数据 |
| PlayerItem | L3 | PlayerItemComponent | 单个陪玩用户卡片数据 |
| PaginationInfo | L4 | - | 分页信息（复用） |
| FilterConfig | L4 | - | 筛选配置（复用） |
| ActionResult | L4 | - | 操作结果（复用） |

---

## 🔄 STEP 2: 流程图

### 页面初始化流程

```
开始
 ↓
【进入王者荣耀陪玩列表页】
 ├─→ 入口来源:
 │    ├── 首页游戏图标点击（主要入口）
 │    ├── 首页限时专享"更多"按钮
 │    └── 搜索结果跳转
 ├─→ 路由跳转: /game/player-list
 ├─→ 传入参数: { gameId: 'wzry', source: 'home'|'featured' }
 ├─→ 从首页继承: latitude, longitude（用于距离计算）
 └─→ 默认筛选: sortType='smart', genderFilter='all'
 ↓
【页面初始化】
 │
 ├─→ 调用 [API:getFilterConfig] → 获取筛选配置
 │    ├─→ 渲染 [→FilterBarArea] 筛选栏
 │    ├─→ 渲染 [→QuickTagArea] 快捷标签
 │    └─→ 缓存筛选选项数据
 │
 └─→ 调用 [API:getPlayerList] (page=1) → 获取首屏数据
      ├─→ 显示Loading [状态:ContentArea]
      ├─→ 成功 → 渲染 [→ContentArea] 用户列表
      └─→ 失败 → 显示错误提示 → 点击重试
 ↓
用户操作
 │
 ├─→ 【FilterBarArea 排序交互】
 │    │
 │    └─→ 点击排序按钮 [触发:FilterBarArea.SortButton]
 │         ├─→ 显示 SortDropdown [状态:showSortDropdown=true]
 │         │
 │         └─→ 选择排序选项 [触发:SortDropdown.Option]
 │              ├─→ 更新排序状态 [状态:FilterData.sortType]
 │              ├─→ 关闭下拉 [状态:showSortDropdown=false]
 │              ├─→ 调用 [API:getPlayerList] (sort={sortType}, page=1)
 │              └─→ 替换内容 [状态:ContentArea]
 │
 ├─→ 【FilterBarArea 性别筛选】
 │    │
 │    └─→ 点击性别按钮 [触发:FilterBarArea.GenderButton]
 │         ├─→ 显示 GenderDropdown [状态:showGenderDropdown=true]
 │         │
 │         └─→ 选择性别选项 [触发:GenderDropdown.Option]
 │              ├─→ 更新性别状态 [状态:FilterData.genderFilter]
 │              ├─→ 关闭下拉 [状态:showGenderDropdown=false]
 │              ├─→ 调用 [API:getPlayerList] (gender={genderFilter}, page=1)
 │              └─→ 替换内容 [状态:ContentArea]
 │
 ├─→ 【FilterBarArea 筛选面板】
 │    │
 │    └─→ 点击筛选按钮 [触发:FilterBarArea.FilterButton]
 │         ├─→ 显示 FilterSheet [状态:showFilterSheet=true]
 │         │
 │         ├─→ 选择筛选选项 [触发:FilterSheet.Options]
 │         │    └─→ 更新临时筛选状态
 │         │
 │         ├─→ 点击重置 [触发:FilterSheet.ResetButton]
 │         │    └─→ 清空所有筛选选项
 │         │
 │         └─→ 点击完成 [触发:FilterSheet.ConfirmButton]
 │              ├─→ 应用筛选条件 [状态:FilterData.activeFilters]
 │              ├─→ 关闭面板 [状态:showFilterSheet=false]
 │              ├─→ 调用 [API:getPlayerList] (filters={...}, page=1)
 │              └─→ 替换内容 [状态:ContentArea]
 │
 ├─→ 【QuickTagArea 快捷标签】
 │    │
 │    └─→ 点击标签 [触发:QuickTagArea.Tag]
 │         ├─→ 更新选中态 [状态:QuickTagData.currentTag]
 │         ├─→ 调用 [API:getPlayerList] (quickTag={tagKey}, page=1)
 │         └─→ 替换内容 [状态:ContentArea]
 │
 ├─→ 【ContentArea 列表交互】
 │    │
 │    ├─→ 下拉刷新 [触发:ContentArea]
 │    │    ├─→ 调用 [API:getPlayerList] (page=1)
 │    │    └─→ 清空重置 [状态:ContentArea]
 │    │
 │    ├─→ 上拉加载 [触发:ContentArea]
 │    │    ├─→ 调用 [API:getPlayerList] (page+1)
 │    │    └─→ 追加数据 [状态:ContentArea]
 │    │
 │    └─→ 滚动浏览 → 图片懒加载
 │
 ├─→ 【PlayerItem 单项操作】
 │    │
 │    └─→ 点击用户卡片 [触发:PlayerItem]
 │         └─→ 跳转 → 【用户详情页】(携带 userId)
 │
 └─→ 【HeaderArea 导航返回】
      └─→ 点击返回 [触发:HeaderArea]
           └─→ 返回上一页
 ↓
【状态管理】 [状态:ContentArea]
 ├─→ isLoading && page=1 → 显示骨架屏
 ├─→ isLoading && page>1 → 显示底部Loading
 ├─→ isError → 显示错误提示 → 点击重试
 ├─→ list.length=0 → 显示空状态"暂无陪玩用户"
 └─→ hasMore=false → 显示"没有更多啦~"
 ↓
结束
```

### 筛选面板交互详情

```
【筛选面板 FilterSheet】
 │
 ├─→ 打开面板 [触发:FilterBarArea.筛选按钮]
 │    ├─→ 从底部滑入
 │    └─→ 显示遮罩层
 │
 ├─→ 选择筛选项
 │    │
 │    ├─→ 【状态】单选
 │    │    └─→ 在线（选中高亮）
 │    │
 │    ├─→ 【大区】单选
 │    │    └─→ QQ区 / 微信区
 │    │
 │    ├─→ 【段位】多选
 │    │    └─→ 尊贵铂金 / 永恒钻石 / 至尊星耀 / 最强王者 / 荣耀王者
 │    │
 │    ├─→ 【价格】单选
 │    │    └─→ 4-9币 / 10-19币 / 20币以上
 │    │
 │    ├─→ 【位置】多选
 │    │    └─→ 打野 / 上路 / 中路 / 下路 / 辅助 / 全能
 │    │
 │    ├─→ 【标签】多选
 │    │    └─→ 荣耀王者 / 大神认证 / 巅峰赛 / 带粉上分 / 官方认证 / 声优陪玩
 │    │
 │    └─→ 【所在地】单选
 │         └─→ 同城
 │
 ├─→ 重置按钮
 │    └─→ 清空所有已选项 → 恢复默认状态
 │
 └─→ 完成按钮
      ├─→ 收集所有已选筛选条件
      ├─→ 关闭面板
      └─→ 调用 [API:getPlayerList] 应用筛选
```

### 流程-组件关联表

| 流程节点 | 触发组件 | 调用接口 | 影响组件 | 状态变化 |
|----------|----------|----------|----------|----------|
| 页面初始化 | - | getFilterConfig, getPlayerList | FilterBarArea, QuickTagArea, ContentArea | loading→loaded |
| 排序切换 | SortDropdown | getPlayerList(sort) | ContentArea | 内容替换 |
| 性别筛选 | GenderDropdown | getPlayerList(gender) | ContentArea | 内容替换 |
| 筛选确认 | FilterSheet | getPlayerList(filters) | ContentArea | 内容替换 |
| 标签切换 | QuickTagArea | getPlayerList(quickTag) | ContentArea | 内容替换 |
| 下拉刷新 | ContentArea | getPlayerList(page=1) | ContentArea | refreshing→loaded |
| 上拉加载 | ContentArea | getPlayerList(page+1) | ContentArea | loadingMore→loaded |
| 点击用户 | PlayerItem | - | - | 跳转用户详情 |
| 返回 | HeaderArea | - | - | 返回上一页 |

### 状态机视图

> 用于描述复杂交互的状态转换，补充线性流程图无法表达的状态切换

#### 页面整体状态机

```
                    ┌─────────────────────────────────────────┐
                    │                                         │
                    ▼                                         │
┌──────────┐  初始化  ┌──────────┐  数据加载完成  ┌──────────┐ │
│  空闲态  │ ───────→ │  加载态  │ ────────────→ │  就绪态  │ │
└──────────┘          └──────────┘               └────┬─────┘ │
                           │                          │       │
                           │ 加载失败                 │       │
                           ▼                          │       │
                    ┌──────────┐  重试                │       │
                    │  错误态  │ ─────────────────────┘       │
                    └──────────┘                              │
                                                              │
                    ┌──────────┐  筛选/排序/刷新              │
就绪态 ───────────→ │  刷新态  │ ────────────────────────────┘
                    └──────────┘
```

#### 排序下拉状态机

```
┌──────────┐  点击排序按钮  ┌──────────┐
│  收起态  │ ────────────→ │  展开态  │
└──────────┘ ←──────────── └──────────┘
              点击选项/
              点击遮罩
```

#### 性别筛选状态机

```
┌──────────┐  点击性别按钮  ┌──────────┐
│  收起态  │ ────────────→ │  展开态  │
└──────────┘ ←──────────── └──────────┘
              点击选项/
              点击遮罩
```

#### 筛选面板状态机

```
┌──────────┐  点击筛选按钮  ┌──────────────┐  点击完成  ┌──────────┐
│  关闭态  │ ────────────→ │  筛选面板态  │ ─────────→ │  关闭态  │
└──────────┘               └──────┬───────┘            └──────────┘
     ▲                            │                         ▲
     │                            │ 点击重置                │
     │                            ▼                         │
     │                     ┌──────────────┐                │
     │                     │ 清空选项态   │                │
     │                     └──────────────┘                │
     │                                                      │
     └───────────────── 点击遮罩/下滑关闭 ─────────────────┘
```

#### 列表状态机

```
┌──────────┐
│  空列表  │ ←─ list.length=0
└──────────┘

┌──────────┐  上拉触底  ┌──────────┐  加载完成  ┌──────────┐
│ 正常列表 │ ─────────→ │ 加载更多 │ ─────────→ │ 正常列表 │
└──────────┘            └──────────┘            └──────────┘
     │                                               │
     │ 下拉刷新                                      │ hasMore=false
     ▼                                               ▼
┌──────────┐                                   ┌──────────┐
│  刷新中  │                                   │ 到底提示 │
└──────────┘                                   └──────────┘
```

---

## 🌳 STEP 3: 树状图

```
【Game模块】★★★
│
├── 【王者荣耀陪玩列表页】📱 [L1] [拆分:5个L2]
│   │   文件: GamePlayerListPage/index.tsx
│   │   路由: /game/player-list?gameId=wzry
│   │
│   ├── 📍 HeaderArea [L2] [固定顶部]
│   │   │   文件: HeaderArea.tsx
│   │   │   布局: flex-row, space-between, 高度44px
│   │   │
│   │   ├── 《BackButton》[L3] [位置:TL]
│   │   │   └── ← 返回图标 [样式:24x24]
│   │   │       └── 点击 → 返回上一页
│   │   │
│   │   └── 《Title》[L3] [位置:TC]
│   │       └── "王者荣耀" [data:HeaderData.title]
│   │           └── [样式:18sp#333333粗体]
│   │
│   ├── 📍 FilterBarArea [L2] [固定顶部]
│   │   │   文件: FilterBarArea.tsx
│   │   │   布局: flex-row, space-around, 高度44px
│   │   │
│   │   ├── 《SortButton》[L3] [位置:左1/3]
│   │   │   │   布局: flex-row, center, gap-4px
│   │   │   │
│   │   │   ├── "智能排序" [data:FilterData.sortLabel]
│   │   │   │   └── [样式:14sp#333333]
│   │   │   └── ▼ 下拉图标 [样式:12x12]
│   │   │       └── 点击 → 显示SortDropdown
│   │   │
│   │   ├── 《GenderButton》[L3] [位置:中1/3]
│   │   │   │   布局: flex-row, center, gap-4px
│   │   │   │
│   │   │   ├── "不限性别" [data:FilterData.genderLabel]
│   │   │   │   └── [样式:14sp#333333]
│   │   │   └── ▼ 下拉图标 [样式:12x12]
│   │   │       └── 点击 → 显示GenderDropdown
│   │   │
│   │   └── 《FilterButton》[L3] [位置:右1/3]
│   │       │   布局: flex-row, center, gap-4px
│   │       │
│   │       ├── "筛选" [样式:14sp#333333]
│   │       └── ▼ 下拉图标 [样式:12x12]
│   │           └── 点击 → 显示FilterSheet
│   │
│   ├── 🏷️ QuickTagArea [L2] [固定顶部]
│   │   │   文件: QuickTagArea.tsx
│   │   │   布局: flex-row, scroll-x, gap-12px, padding:12px 16px
│   │   │
│   │   └── 《QuickTag》[L3] [1模板xN实例] [data:QuickTagData.tags]
│   │       │
│   │       ├── [选中状态] → 紫色背景+白字
│   │       │   └── [样式:padding:8px 16px, 圆角16px, bg:#8B5CF6, #FFFFFF]
│   │       │
│   │       └── [默认状态] → 灰色背景+黑字
│   │           └── [样式:padding:8px 16px, 圆角16px, bg:#F5F5F5, #333333]
│   │
│   ├── 🏷️ ContentArea [L2] [flex:1, 可滚动]
│   │   │   文件: ContentArea/
│   │   │   ├── index.tsx
│   │   │   ├── types.ts
│   │   │   └── useContentArea.ts
│   │   │   布局: flex-col, scroll-y
│   │   │
│   │   ├── 📋 PlayerList [布局:flex-col]
│   │   │   │
│   │   │   └── 《PlayerItem》[L3] [1模板xN实例] [data:ListData.list]
│   │   │       │   文件: ContentArea/PlayerItem/
│   │   │       │   │   ├── index.tsx
│   │   │       │   │   └── types.ts
│   │   │       │   布局: flex-row, padding:16px, gap-12px
│   │   │       │   样式: 白色背景, 底部分隔线1px#F5F5F5
│   │   │       │
│   │   │       ├── 《Avatar》[L4] [位置:左侧] [固定120px]
│   │   │       │   │   [data:PlayerItem.avatarData]
│   │   │       │   │
│   │   │       │   └── 头像/视频封面 [样式:120x160圆角8px]
│   │   │       │       └── [条件:isVideo] → 显示播放图标
│   │   │       │
│   │   │       ├── 《PlayerInfo》[L4] [位置:中间] [flex:1]
│   │   │       │   │   布局: flex-col, gap-6px
│   │   │       │   │
│   │   │       │   ├── R1: 昵称+性别年龄
│   │   │       │   │   │   布局: flex-row, items-center, gap-8px
│   │   │       │   │   │
│   │   │       │   │   ├── 昵称 [data:PlayerItem.basicInfo.nickname]
│   │   │       │   │   │   └── [样式:16sp#333333粗体]
│   │   │       │   │   │
│   │   │       │   │   └── 《GenderAgeBadge》[L5]
│   │   │       │   │       │   [data:PlayerItem.basicInfo.gender, age]
│   │   │       │   │       └── [样式:圆角标签, 粉色背景]
│   │   │       │   │           └── "♀ 19"
│   │   │       │   │
│   │   │       │   ├── R2: 认证标签行
│   │   │       │   │   │   布局: flex-row, gap-8px
│   │   │       │   │   │
│   │   │       │   │   ├── 《VerifiedBadge》[L5] [条件:isVerified=true]
│   │   │       │   │   │   │   [data:PlayerItem.certificationData.isVerified]
│   │   │       │   │   │   └── ✓ "实名认证"
│   │   │       │   │   │       └── [样式:绿色背景+白字, 圆角12px]
│   │   │       │   │   │
│   │   │       │   │   └── 《ExpertBadge》[L5] [条件:isExpert=true]
│   │   │       │   │       │   [data:PlayerItem.certificationData.isExpert]
│   │   │       │   │       └── 🏆 "大神"
│   │   │       │   │           └── [样式:橙色背景+白字, 圆角12px]
│   │   │       │   │
│   │   │       │   ├── R3: 技能介绍
│   │   │       │   │   │   [data:PlayerItem.skillData.description]
│   │   │       │   │   └── "主打野其他位置都能补 能c技术万战韩信..."
│   │   │       │   │       └── [样式:14sp#666666, 最多2行省略]
│   │   │       │   │
│   │   │       │   └── R4: 游戏标签行
│   │   │       │       │   布局: flex-row, gap-8px
│   │   │       │       │   [data:PlayerItem.gameTagData]
│   │   │       │       │
│   │   │       │       ├── 《GameTag》"微信区" [data:serverRegion]
│   │   │       │       │   └── [样式:紫色文字, 无背景]
│   │   │       │       │
│   │   │       │       ├── 《GameTag》"荣耀王者" [data:rank]
│   │   │       │       │   └── [样式:紫色文字, 无背景]
│   │   │       │       │
│   │   │       │       └── 《GameTag》"巅峰1800+" [data:peakScore]
│   │   │       │           └── [样式:紫色文字, 无背景]
│   │   │       │
│   │   │       └── 《PriceDistance》[L4] [位置:右侧]
│   │   │           │   布局: flex-col, items-end, justify-between
│   │   │           │
│   │   │           ├── 距离 [data:PlayerItem.locationData.distance]
│   │   │           │   └── "3.2km" [样式:12sp#999999]
│   │   │           │
│   │   │           └── 价格 [data:PlayerItem.priceData]
│   │   │               ├── "10" [样式:20sp#FF6B6B粗体]
│   │   │               └── "金币/局" [样式:12sp#999999]
│   │   │
│   │   ├── 《LoadingMore》[L3] [条件:isLoading且page>1]
│   │   │   └── Loading指示器
│   │   │
│   │   └── 《EndTip》[L3] [条件:hasMore=false]
│   │       └── "没有更多啦~" [样式:14sp#CCCCCC, 居中]
│   │
│   └── 🔧 弹窗组件层
│       │
│       ├── 《SortDropdown》[L2] [条件:showSortDropdown=true]
│       │   │   文件: SortDropdown.tsx
│       │   │   布局: 绝对定位, 从FilterBarArea下方展开
│       │   │   样式: 白色背景, 圆角12px, 阴影
│       │   │
│       │   └── 《SortOption》[L3] [1模板x4实例]
│       │       │   [data:FilterBarArea.sortOptions]
│       │       │
│       │       ├── "智能排序" + ✓ [选中-紫色]
│       │       ├── "最新排序"
│       │       ├── "最近排序"
│       │       └── "人气排序"
│       │
│       ├── 《GenderDropdown》[L2] [条件:showGenderDropdown=true]
│       │   │   文件: GenderDropdown.tsx
│       │   │   布局: 绝对定位, 从FilterBarArea下方展开
│       │   │   样式: 白色背景, 圆角12px, 阴影
│       │   │
│       │   └── 《GenderOption》[L3] [1模板x3实例]
│       │       │   [data:FilterBarArea.genderOptions]
│       │       │
│       │       ├── "不限性别" + ✓ [选中-紫色]
│       │       ├── "只看女生"
│       │       └── "只看男生"
│       │
│       └── 《FilterSheet》[L2] [条件:showFilterSheet=true]
│           │   文件: FilterSheet/
│           │   │   ├── index.tsx
│           │   │   ├── types.ts
│           │   │   └── FilterGroup.tsx
│           │   布局: 底部弹出面板, 高度约80%
│           │   样式: 白色背景, 顶部圆角16px
│           │
│           ├── 《FilterGroup》[L3] [1模板x7实例]
│           │   │   [data:FilterSheetArea.filterGroups]
│           │   │
│           │   ├── 【状态】单选
│           │   │   └── 《FilterOption》"在线" [选中-紫色]
│           │   │
│           │   ├── 【大区】单选
│           │   │   ├── 《FilterOption》"QQ区" [选中-紫色]
│           │   │   └── 《FilterOption》"微信区"
│           │   │
│           │   ├── 【段位】多选
│           │   │   ├── 《FilterOption》"尊贵铂金" [选中-紫色]
│           │   │   ├── 《FilterOption》"永恒钻石"
│           │   │   ├── 《FilterOption》"至尊星耀"
│           │   │   ├── 《FilterOption》"最强王者"
│           │   │   └── 《FilterOption》"荣耀王者"
│           │   │
│           │   ├── 【价格】单选
│           │   │   ├── 《FilterOption》"4-9币"
│           │   │   ├── 《FilterOption》"10-19币"
│           │   │   └── 《FilterOption》"20币以上"
│           │   │
│           │   ├── 【位置】多选
│           │   │   ├── 《FilterOption》"打野" [选中-紫色]
│           │   │   ├── 《FilterOption》"上路"
│           │   │   ├── 《FilterOption》"中路"
│           │   │   ├── 《FilterOption》"下路"
│           │   │   ├── 《FilterOption》"辅助"
│           │   │   └── 《FilterOption》"全能"
│           │   │
│           │   ├── 【标签】多选
│           │   │   ├── 《FilterOption》"荣耀王者" [选中-紫色]
│           │   │   ├── 《FilterOption》"大神认证" [选中-紫色]
│           │   │   ├── 《FilterOption》"巅峰赛"
│           │   │   ├── 《FilterOption》"带粉上分"
│           │   │   ├── 《FilterOption》"官方认证"
│           │   │   └── 《FilterOption》"声优陪玩"
│           │   │
│           │   └── 【所在地】单选
│           │       └── 《FilterOption》"同城"
│           │
│           └── 《ActionBar》[L3] [固定底部]
│               │   布局: flex-row, gap-16px, padding:16px
│               │
│               ├── 「重置」[样式:灰色边框按钮]
│               │   └── 点击 → 清空所有筛选
│               │
│               └── 「完成」[样式:紫色渐变按钮]
│                   └── 点击 → 应用筛选 + 关闭面板
│
└── 🔧 服务层（对应 STEP 6 的接口）
    ├── 📡 GET /api/game/player/list         → 陪玩列表 [→ PageModel.ListData]
    ├── 📡 GET /api/game/player/filter-config → 筛选配置 [→ PageModel.FilterData]
    └── 📡 POST /api/game/player/{action}    → 操作 [→ SharedModel.ActionResult]
```

### 列表控制

```
🔄 ListControl [适用于 ContentArea]
├── 加载更多: 上滑 [距底100px] → 调用列表接口(page+1)
├── 下拉刷新: [阈值60px] → 调用列表接口(page=1)
├── 骨架屏: [条件:isLoading且page=1] 显示占位
├── 加载指示: [条件:isLoading且page>1] 显示底部loading
├── 空状态: [条件:list.length=0] 显示"暂无陪玩用户"
└── 到底提示: [条件:hasMore=false] "没有更多啦~"
```

### 组件复用关系

```
组件复用：
├── PlayerItem           → 列表项，可跨游戏复用
├── GenderAgeBadge       → 性别年龄标签，跨页面复用
├── VerifiedBadge        → 实名认证标签，跨页面复用
├── ExpertBadge          → 大神认证标签，游戏模块复用
├── GameTag              → 游戏标签，游戏模块复用
├── FilterSheet          → 筛选面板，可配置化复用
├── SortDropdown         → 排序下拉，通用组件
├── GenderDropdown       → 性别下拉，通用组件
└── EmptyState           → 空状态，模块内复用
```

### 交互速查表

> 快速查阅每个可点击组件的行为和目标，便于开发时快速定位交互逻辑

#### 导航交互

| 组件 | 点击行为 | 目标/效果 | 备注 |
|------|----------|-----------|------|
| BackButton | 返回 | 上一页 | router.back() |
| PlayerItem | 跳转 | 用户详情页 | 携带userId |

#### 筛选栏交互

| 组件 | 点击行为 | 目标/效果 | 备注 |
|------|----------|-----------|------|
| SortButton | 展开 | SortDropdown | 切换showSortDropdown |
| GenderButton | 展开 | GenderDropdown | 切换showGenderDropdown |
| FilterButton | 展开 | FilterSheet | 切换showFilterSheet |

#### 下拉菜单交互

| 组件 | 点击行为 | 目标/效果 | 备注 |
|------|----------|-----------|------|
| SortOption | 选择+关闭 | 更新sortType + 刷新列表 | 单选 |
| GenderOption | 选择+关闭 | 更新genderFilter + 刷新列表 | 单选 |
| 下拉遮罩层 | 关闭 | 隐藏下拉菜单 | 不触发筛选 |

#### 筛选面板交互

| 组件 | 点击行为 | 目标/效果 | 备注 |
|------|----------|-----------|------|
| FilterOption (单选组) | 切换选中 | 更新临时筛选状态 | 互斥 |
| FilterOption (多选组) | 切换选中 | 更新临时筛选状态 | 可多选 |
| ResetButton | 清空 | 重置所有筛选项 | 不关闭面板 |
| ConfirmButton | 应用+关闭 | 应用筛选 + 刷新列表 | 关闭面板 |
| 面板遮罩层 | 关闭 | 隐藏筛选面板 | 不应用筛选 |

#### 快捷标签交互

| 组件 | 点击行为 | 目标/效果 | 备注 |
|------|----------|-----------|------|
| QuickTag (未选中) | 选中 | 切换currentTag + 刷新列表 | 单选 |
| QuickTag (已选中) | 取消 | 清空currentTag + 刷新列表 | 可取消 |

#### 列表交互

| 组件 | 手势/行为 | 目标/效果 | 备注 |
|------|----------|-----------|------|
| ContentArea | 下拉 | 刷新列表 (page=1) | 阈值60px |
| ContentArea | 上拉触底 | 加载更多 (page+1) | 距底100px |
| ContentArea | 滚动 | 图片懒加载 | 自动触发 |

---

## 📍 STEP 4: 布局定位

### 页面整体布局

```
┌─────────────────────────────────────────────────────────────────┐
│  📱 GamePlayerListPage [L1]                                      │
│  布局: flex-col | 全屏                                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  HeaderArea [L2] | 固定顶部 | 高度:44px                   │    │
│  │  ┌────┐              ┌──────────────┐                    │    │
│  │  │ ← │              │  王者荣耀    │                    │    │
│  │  └────┘              └──────────────┘                    │    │
│  │  [TL]                     [TC]                           │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  FilterBarArea [L2] | 固定顶部 | 高度:44px                │    │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐         │    │
│  │  │ 智能排序 ▼ │  │ 不限性别 ▼ │  │   筛选 ▼  │         │    │
│  │  └────────────┘  └────────────┘  └────────────┘         │    │
│  │      [1/3]            [1/3]           [1/3]              │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  QuickTagArea [L2] | 固定顶部 | 高度:48px | scroll-x      │    │
│  │  ┌────────┐ ┌────────┐ ┌──────────┐ ┌──────┐ ...        │    │
│  │  │荣耀王者│ │带粉上分│ │电竞陪练师│ │ 陪玩 │ →          │    │
│  │  │ [选中] │ │        │ │          │ │      │            │    │
│  │  └────────┘ └────────┘ └──────────┘ └──────┘            │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  ContentArea [L2] | flex:1 | scroll-y                    │    │
│  │                                                          │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │  PlayerItem [L3]                                 │    │    │
│  │  │  ┌────────┐  ┌─────────────────────┐  ┌───────┐│    │    │
│  │  │  │        │  │ 昵称123    ♀19     │  │ 3.2km ││    │    │
│  │  │  │        │  │ ✓实名认证  🏆大神   │  │       ││    │    │
│  │  │  │  头像  │  │ 主打野其他位置都能补│  │       ││    │    │
│  │  │  │ 120x160│  │ 能c技术万战韩信... │  │  10   ││    │    │
│  │  │  │        │  │ 微信区 荣耀王者 巅峰│  │金币/局││    │    │
│  │  │  └────────┘  └─────────────────────┘  └───────┘│    │    │
│  │  │  [固定120px]       [flex:1]          [固定宽度]│    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │  PlayerItem [L3] ... x N                        │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │  ─────────────────────────────────────────────────────  │    │
│  │                                                          │    │
│  │  ┌─────────────────────────────────────────────────┐    │    │
│  │  │            没有更多啦~                           │    │    │
│  │  │               [BC]                              │    │    │
│  │  └─────────────────────────────────────────────────┘    │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 排序下拉菜单布局

```
┌─────────────────────────────────────────────────────────────────┐
│  SortDropdown [L2]                                               │
│  布局: 绝对定位, 从FilterBarArea下方展开                          │
│  样式: 白色背景, 圆角12px, 阴影                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  智能排序                                          ✓    │    │ 选中-紫色
│  └─────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  最新排序                                               │    │
│  └─────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  最近排序                                               │    │
│  └─────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  人气排序                                               │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  每项高度: 48px | padding: 0 16px                                │
│  选中项: 紫色文字 + 右侧勾                                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 性别下拉菜单布局

```
┌─────────────────────────────────────────────────────────────────┐
│  GenderDropdown [L2]                                             │
│  布局: 绝对定位, 从FilterBarArea下方展开                          │
│  样式: 白色背景, 圆角12px, 阴影                                   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  不限性别                                          ✓    │    │ 选中-紫色
│  └─────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  只看女生                                               │    │
│  └─────────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  只看男生                                               │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  每项高度: 48px | padding: 0 16px                                │
│  选中项: 紫色文字 + 右侧勾                                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 筛选面板布局

```
┌─────────────────────────────────────────────────────────────────┐
│  FilterSheet [L2]                                                │
│  布局: 底部弹出面板, 高度约80%                                    │
│  样式: 白色背景, 顶部圆角16px                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  HeaderArea | 高度:44px                                  │    │
│  │  ┌────┐           王者荣耀                               │    │
│  │  │ ← │                                                  │    │
│  │  └────┘                                                  │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  FilterBarArea | 高度:44px | 灰色/透明                   │    │
│  │  智能排序 ▼      不限性别 ▼      筛选 ▲                  │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  ScrollArea | flex:1, scroll-y                           │    │
│  │                                                          │    │
│  │  【状态】                                                 │    │
│  │  ┌────────┐                                              │    │
│  │  │  在线  │ [选中-紫色背景]                              │    │
│  │  └────────┘                                              │    │
│  │                                                          │    │
│  │  【大区】                                                 │    │
│  │  ┌────────┐  ┌────────┐                                  │    │
│  │  │  QQ区  │  │ 微信区 │                                  │    │
│  │  │ [选中] │  │        │                                  │    │
│  │  └────────┘  └────────┘                                  │    │
│  │                                                          │    │
│  │  【段位】                                                 │    │
│  │  ┌────────┐  ┌────────┐  ┌────────┐                      │    │
│  │  │尊贵铂金│  │永恒钻石│  │至尊星耀│                      │    │
│  │  │ [选中] │  │        │  │        │                      │    │
│  │  └────────┘  └────────┘  └────────┘                      │    │
│  │  ┌────────┐  ┌────────┐                                  │    │
│  │  │最强王者│  │荣耀王者│                                  │    │
│  │  └────────┘  └────────┘                                  │    │
│  │                                                          │    │
│  │  【价格】                                                 │    │
│  │  ┌────────┐  ┌────────┐  ┌────────┐                      │    │
│  │  │ 4-9币  │  │10-19币 │  │20币以上│                      │    │
│  │  └────────┘  └────────┘  └────────┘                      │    │
│  │                                                          │    │
│  │  【位置】                                                 │    │
│  │  ┌────────┐  ┌────────┐  ┌────────┐                      │    │
│  │  │  打野  │  │  上路  │  │  中路  │                      │    │
│  │  │ [选中] │  │        │  │        │                      │    │
│  │  └────────┘  └────────┘  └────────┘                      │    │
│  │  ┌────────┐  ┌────────┐  ┌────────┐                      │    │
│  │  │  下路  │  │  辅助  │  │  全能  │                      │    │
│  │  └────────┘  └────────┘  └────────┘                      │    │
│  │                                                          │    │
│  │  【标签】                                                 │    │
│  │  ┌────────┐  ┌────────┐  ┌────────┐                      │    │
│  │  │荣耀王者│  │大神认证│  │ 巅峰赛 │                      │    │
│  │  │ [选中] │  │ [选中] │  │        │                      │    │
│  │  └────────┘  └────────┘  └────────┘                      │    │
│  │  ┌────────┐  ┌────────┐  ┌────────┐                      │    │
│  │  │带粉上分│  │官方认证│  │声优陪玩│                      │    │
│  │  └────────┘  └────────┘  └────────┘                      │    │
│  │                                                          │    │
│  │  【所在地】                                               │    │
│  │  ┌────────┐                                              │    │
│  │  │  同城  │                                              │    │
│  │  └────────┘                                              │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │  ActionBar | 固定底部 | 高度:80px                        │    │
│  │  ┌──────────────┐    ┌──────────────────────────────┐   │    │
│  │  │     重置     │    │           完成               │   │    │
│  │  │  (灰色边框)  │    │      (紫色渐变背景)          │   │    │
│  │  └──────────────┘    └──────────────────────────────┘   │    │
│  │      [1/3]                      [2/3]                   │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### PlayerItem 布局详图

```
┌─────────────────────────────────────────────────────────────────┐
│  PlayerItem [L3]                                                 │
│  布局: flex-row, items-start                                     │
│  高度: auto | padding: 16px | gap: 12px                          │
│  底部: 分隔线 1px #F5F5F5                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌──────────────┐  ┌───────────────────────────┐  ┌───────────┐ │
│  │              │  │ R1: 昵称123  ┌────────┐  │  │   3.2km   │ │
│  │              │  │              │ ♀ 19   │  │  │  [TR]     │ │
│  │    Avatar    │  │              └────────┘  │  │           │ │
│  │   120x160    │  ├───────────────────────────┤  │           │ │
│  │    圆角8px   │  │ R2: ✓实名认证  🏆大神    │  │           │ │
│  │              │  ├───────────────────────────┤  │           │ │
│  │  [可能是     │  │ R3: 主打野其他位置都能补  │  │    10     │ │
│  │   视频封面]  │  │     能c技术万战韩信...    │  │  金币/局  │ │
│  │              │  ├───────────────────────────┤  │   [BR]    │ │
│  │              │  │ R4: 微信区 荣耀王者       │  │           │ │
│  │              │  │     巅峰1800+             │  │           │ │
│  └──────────────┘  └───────────────────────────┘  └───────────┘ │
│   [固定120px]            [flex:1]                [固定80px]      │
│                                                                  │
│  PlayerInfo 内部布局: flex-col, gap-6px                          │
│  R1布局: flex-row, items-center, gap-8px                         │
│  R2布局: flex-row, gap-8px                                       │
│  R4布局: flex-row, flex-wrap, gap-8px                            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 筛选选项样式

```
┌─────────────────────────────────────────────────────────────────┐
│  FilterOption 状态样式                                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  【选中状态】                                                    │
│  ┌────────────────┐                                             │
│  │    荣耀王者    │  背景: #F3E8FF (淡紫色)                     │
│  │                │  文字: #8B5CF6 (紫色)                       │
│  └────────────────┘  边框: 1px #8B5CF6                          │
│                      尺寸: auto x 32px, 圆角16px                 │
│                                                                  │
│  【默认状态】                                                    │
│  ┌────────────────┐                                             │
│  │    永恒钻石    │  背景: #F5F5F5 (浅灰色)                     │
│  │                │  文字: #333333 (黑色)                       │
│  └────────────────┘  边框: 无                                   │
│                      尺寸: auto x 32px, 圆角16px                 │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 📁 STEP 5: 代码结构

```
src/modules/
│
├─ Game/                                     # 游戏模块
│   │
│   ├─ api/                                  # 模块级API
│   │   ├─ apiGetPlayerList.ts               # 获取陪玩用户列表
│   │   ├─ apiGetFilterConfig.ts             # 获取筛选配置
│   │   └─ apiPlayerAction.ts                # 用户操作（预约/收藏等）
│   │
│   ├─ stores/                               # 模块级状态
│   │   └─ useGameFilterStore.ts             # 游戏筛选状态管理
│   │
│   ├─ hooks/                                # 模块级Hooks
│   │   └─ usePlayerList.ts                  # 陪玩列表Hook
│   │
│   │   ┌─────────────────────────────────────────────────────────────┐
│   │   │  📱 页面 [L1] - GamePlayerListPage/index.tsx                 │
│   │   ├─────────────────────────────────────────────────────────────┤
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  HeaderArea [L2]                                    │   │ 固定
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  FilterBarArea [L2]                                 │   │ 固定
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  QuickTagArea [L2]                                  │   │ 固定
│   │   │  └─────────────────────────────────────────────────────┘   │
│   │   │  ┌─────────────────────────────────────────────────────┐   │
│   │   │  │  ContentArea [L2]                                   │   │
│   │   │  │    └── PlayerItem [L3] x N                          │   │ flex:1
│   │   │  └─────────────────────────────────────────────────────┘   │ 可滚动
│   │   │  布局: flex-col | 弹窗组件条件渲染                          │
│   │   └─────────────────────────────────────────────────────────────┘
│   │
│   ├─ GamePlayerListPage/                   # 陪玩列表页面
│   │   │
│   │   ├─ index.tsx                         # 页面主文件 [L1]
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  页面职责:                                               │
│   │   │   │  - 组合区域组件                                          │
│   │   │   │  - 管理弹窗显示状态                                       │
│   │   │   │  - 处理筛选/排序逻辑                                      │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ types.ts                          # 页面类型定义
│   │   ├─ constants.ts                      # 常量定义
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - HeaderArea.tsx                       │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌────┐              ┌──────────────┐                   │
│   │   │   │  │ ← │              │  王者荣耀    │                   │
│   │   │   │  └────┘              └──────────────┘                   │
│   │   │   │  [TL]                     [TC]                          │
│   │   │   │  布局: flex-row, space-between | 高度: 44px              │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ HeaderArea.tsx                    # 🟢 头部区域（单文件）
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - FilterBarArea.tsx                    │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌────────────┐ ┌────────────┐ ┌────────────┐          │
│   │   │   │  │ 智能排序 ▼│ │ 不限性别 ▼│ │   筛选 ▼  │          │
│   │   │   │  └────────────┘ └────────────┘ └────────────┘          │
│   │   │   │      [1/3]          [1/3]          [1/3]                │
│   │   │   │  布局: flex-row, space-around | 高度: 44px              │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ FilterBarArea.tsx                 # 🟢 筛选栏区域（单文件）
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🟢 简单区域 [L2] - QuickTagArea.tsx                     │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌────────┐ ┌────────┐ ┌──────────┐ ┌──────┐ →        │
│   │   │   │  │荣耀王者│ │带粉上分│ │电竞陪练师│ │ 陪玩 │          │
│   │   │   │  │ [选中] │ │        │ │          │ │      │          │
│   │   │   │  └────────┘ └────────┘ └──────────┘ └──────┘          │
│   │   │   │  布局: flex-row, scroll-x, gap-12px | 高度: 48px        │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ QuickTagArea.tsx                  # 🟢 快捷标签区域（单文件）
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 复杂区域 [L2] - ContentArea/                         │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  ┌─────────────────────────────────────────────────┐   │
│   │   │   │  │  ┌────────┐  ┌────────────────┐  ┌──────────┐  │   │
│   │   │   │  │  │  头像  │  │ 昵称 ♀19      │  │  3.2km   │  │   │
│   │   │   │  │  │ 120x160│  │ ✓实名  🏆大神 │  │    10    │  │   │
│   │   │   │  │  │        │  │ 技能介绍...   │  │ 金币/局  │  │   │
│   │   │   │  │  │        │  │ 微信区 荣耀王者│  │          │  │   │
│   │   │   │  │  └────────┘  └────────────────┘  └──────────┘  │   │
│   │   │   │  └─────────────────────────────────────────────────┘   │
│   │   │   │       PlayerItem [L3] x N                               │
│   │   │   │  布局: flex-col | 滚动: scroll-y                        │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ ContentArea/                      # 🔵 内容区域（文件夹）
│   │   │   │
│   │   │   ├─ index.tsx                     # 区域主文件
│   │   │   ├─ types.ts                      # 类型定义
│   │   │   ├─ useContentArea.ts             # 状态管理Hook
│   │   │   │
│   │   │   └─ PlayerItem/                   # 用户卡片组件 [L3]
│   │   │       ├─ index.tsx                 # 组件主文件
│   │   │       ├─ types.ts                  # 类型定义
│   │   │       └─ PlayerInfo.tsx            # 用户信息子组件 [L4]
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 弹窗组件 [L2] - SortDropdown.tsx                     │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  智能排序 ✓                                             │
│   │   │   │  最新排序                                               │
│   │   │   │  最近排序                                               │
│   │   │   │  人气排序                                               │
│   │   │   │  布局: 绝对定位下拉 | 白色背景 | 阴影                    │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ SortDropdown.tsx                  # 🟢 排序下拉（单文件）
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 弹窗组件 [L2] - GenderDropdown.tsx                   │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  不限性别 ✓                                             │
│   │   │   │  只看女生                                               │
│   │   │   │  只看男生                                               │
│   │   │   │  布局: 绝对定位下拉 | 白色背景 | 阴影                    │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   ├─ GenderDropdown.tsx                # 🟢 性别下拉（单文件）
│   │   │
│   │   │   ┌─────────────────────────────────────────────────────────┐
│   │   │   │  🔵 复杂弹窗 [L2] - FilterSheet/                         │
│   │   │   ├─────────────────────────────────────────────────────────┤
│   │   │   │  底部弹出面板                                            │
│   │   │   │  - 7个筛选分组                                           │
│   │   │   │  - 重置 + 完成按钮                                       │
│   │   │   │  布局: 底部弹出 | 高度80% | 白色背景                     │
│   │   │   └─────────────────────────────────────────────────────────┘
│   │   │
│   │   └─ FilterSheet/                      # 🔵 筛选面板（文件夹）
│   │       ├─ index.tsx                     # 面板主文件
│   │       ├─ types.ts                      # 类型定义
│   │       ├─ FilterGroup.tsx               # 筛选分组组件 [L3]
│   │       └─ FilterOption.tsx              # 筛选选项组件 [L4]
│   │
│   ├─ SharedComponents/                     # 模块共享组件 [L4]
│   │   │
│   │   ├─ GenderAgeBadge/                   # 性别年龄标签
│   │   │   ├─ index.tsx
│   │   │   └─ types.ts
│   │   │
│   │   ├─ VerifiedBadge/                    # 实名认证标签
│   │   │   ├─ index.tsx
│   │   │   └─ types.ts
│   │   │
│   │   ├─ ExpertBadge/                      # 大神认证标签
│   │   │   ├─ index.tsx
│   │   │   └─ types.ts
│   │   │
│   │   ├─ GameTag/                          # 游戏标签
│   │   │   ├─ index.tsx
│   │   │   └─ types.ts
│   │   │
│   │   ├─ PriceBadge/                       # 价格标签
│   │   │   ├─ index.tsx
│   │   │   └─ types.ts
│   │   │
│   │   └─ EmptyState/                       # 空状态组件
│   │       ├─ index.tsx
│   │       └─ types.ts
│   │
│   └─ index.ts                              # 模块入口
│
└─ Common/                                   # 公共模块
    ├─ components/                           # 全局共享组件
    │   ├─ Avatar/                           # 头像组件
    │   ├─ Loading/                          # 加载组件
    │   ├─ Dropdown/                         # 下拉菜单
    │   └─ BottomSheet/                      # 底部弹出面板
    └─ hooks/
        └─ usePagination.ts                  # 分页Hook
```

### 文件命名规范

```
类型          命名格式                        示例
─────────────────────────────────────────────────────────
主组件        index.tsx                       index.tsx
类型定义      types.ts                        types.ts
常量          constants.ts                    constants.ts
状态管理      use{Name}.ts                    useContentArea.ts
API接口       api{Name}{Action}.ts            apiGetPlayerList.ts
子组件        {Name}.tsx                      PlayerInfo.tsx
```

---

## 🗄️ STEP 6: 接口实现与后端设计

### 接口定义

```json
{
  "接口文档信息": {
    "对应页面": "GamePlayerListPage",
    "对应数据模型": "STEP 1 → PageModel",
    "版本": "v1.0"
  },

  "接口列表": [
    {
      "序号": 1,
      "接口名": "获取陪玩用户列表",
      "接口标识": "getPlayerList",
      "路径": "GET /api/game/player/list",
      "触发时机": "[API:getPlayerList] 页面初始化/下拉刷新/上拉加载/筛选切换",
      "对应数据模型": "STEP 1 → PageModel.ListData",

      "请求参数": {
        "gameId": "String - 游戏ID - 'wzry'(王者荣耀)",
        "sortType": "String(smart|newest|recent|popular) - 排序类型 - 默认smart",
        "genderFilter": "String(all|female|male) - 性别筛选 - 默认all",
        "quickTag": "String? - 快捷标签 - [可选]",
        "filters": {
          "onlineStatus": "Boolean? - 在线状态",
          "serverRegion": "String? - 大区(qq|wx)",
          "ranks": "Array<String>? - 段位列表",
          "priceRange": "String? - 价格区间(4-9|10-19|20+)",
          "positions": "Array<String>? - 位置列表",
          "tags": "Array<String>? - 标签列表",
          "sameCity": "Boolean? - 同城"
        },
        "page": "Number - 页码 - 默认1",
        "pageSize": "Number - 每页数量 - 默认20",
        "latitude": "Number? - 纬度 - [可选,用于距离计算]",
        "longitude": "Number? - 经度 - [可选,用于距离计算]"
      },

      "响应数据": {
        "code": "Number - 状态码 - 200成功",
        "message": "String - 提示信息",
        "data": {
          "_映射": "→ STEP 1: PageModel.ListData",
          "list": "Array<PlayerItem> - 用户列表",
          "hasMore": "Boolean - 是否有更多",
          "total": "Number - 总数"
        }
      },

      "响应示例": {
        "code": 200,
        "message": "success",
        "data": {
          "list": [
            {
              "userId": "u_123456",
              "avatarData": {
                "avatarUrl": "https://xxx.com/avatar/123.jpg",
                "isVideo": false
              },
              "basicInfo": {
                "nickname": "昵称123",
                "gender": "female",
                "age": 19
              },
              "certificationData": {
                "isVerified": true,
                "isExpert": true
              },
              "skillData": {
                "description": "主打野其他位置都能补 能c技术万战韩信这里是技能介绍这里..."
              },
              "gameTagData": {
                "serverRegion": "微信区",
                "rank": "荣耀王者",
                "peakScore": "巅峰1800+"
              },
              "priceData": {
                "price": 10,
                "unit": "金币/局"
              },
              "locationData": {
                "distance": "3.2km"
              }
            }
          ],
          "hasMore": true,
          "total": 100
        }
      },

      "数据库映射": {
        "_说明": "此接口数据来源",
        "list[].userId": "users.id",
        "list[].avatarData": "users.avatar, user_profiles.intro_video",
        "list[].basicInfo": "users.nickname, users.gender, users.age",
        "list[].certificationData": "user_certifications表查询",
        "list[].skillData": "user_game_skills.description",
        "list[].gameTagData": "user_game_skills表关联",
        "list[].priceData": "user_game_skills.price, user_game_skills.price_unit",
        "list[].locationData": "根据经纬度计算距离"
      }
    },

    {
      "序号": 2,
      "接口名": "获取筛选配置",
      "接口标识": "getFilterConfig",
      "路径": "GET /api/game/player/filter-config",
      "触发时机": "[API:getFilterConfig] 页面初始化",
      "缓存策略": "本地缓存 24h",
      "对应数据模型": "STEP 1 → PageModel.FilterData + QuickTagData",

      "请求参数": {
        "gameId": "String - 游戏ID - 'wzry'"
      },

      "响应数据": {
        "code": "Number - 状态码",
        "data": {
          "sortOptions": "Array<SortOption> - 排序选项",
          "genderOptions": "Array<GenderOption> - 性别选项",
          "quickTags": "Array<QuickTagItem> - 快捷标签",
          "filterGroups": "Array<FilterGroup> - 筛选分组配置"
        }
      },

      "响应示例": {
        "code": 200,
        "data": {
          "sortOptions": [
            { "key": "smart", "label": "智能排序" },
            { "key": "newest", "label": "最新排序" },
            { "key": "recent", "label": "最近排序" },
            { "key": "popular", "label": "人气排序" }
          ],
          "genderOptions": [
            { "key": "all", "label": "不限性别" },
            { "key": "female", "label": "只看女生" },
            { "key": "male", "label": "只看男生" }
          ],
          "quickTags": [
            { "key": "honor_king", "label": "荣耀王者" },
            { "key": "carry", "label": "带粉上分" },
            { "key": "coach", "label": "电竞陪练师" },
            { "key": "companion", "label": "陪玩" }
          ],
          "filterGroups": [
            {
              "groupKey": "status",
              "groupLabel": "状态",
              "isMultiple": false,
              "options": [{ "key": "online", "label": "在线" }]
            },
            {
              "groupKey": "region",
              "groupLabel": "大区",
              "isMultiple": false,
              "options": [
                { "key": "qq", "label": "QQ区" },
                { "key": "wx", "label": "微信区" }
              ]
            },
            {
              "groupKey": "rank",
              "groupLabel": "段位",
              "isMultiple": true,
              "options": [
                { "key": "platinum", "label": "尊贵铂金" },
                { "key": "diamond", "label": "永恒钻石" },
                { "key": "star", "label": "至尊星耀" },
                { "key": "king", "label": "最强王者" },
                { "key": "honor_king", "label": "荣耀王者" }
              ]
            },
            {
              "groupKey": "price",
              "groupLabel": "价格",
              "isMultiple": false,
              "options": [
                { "key": "4-9", "label": "4-9币" },
                { "key": "10-19", "label": "10-19币" },
                { "key": "20+", "label": "20币以上" }
              ]
            },
            {
              "groupKey": "position",
              "groupLabel": "位置",
              "isMultiple": true,
              "options": [
                { "key": "jungle", "label": "打野" },
                { "key": "top", "label": "上路" },
                { "key": "mid", "label": "中路" },
                { "key": "bottom", "label": "下路" },
                { "key": "support", "label": "辅助" },
                { "key": "all", "label": "全能" }
              ]
            },
            {
              "groupKey": "tags",
              "groupLabel": "标签",
              "isMultiple": true,
              "options": [
                { "key": "honor_king", "label": "荣耀王者" },
                { "key": "expert", "label": "大神认证" },
                { "key": "peak", "label": "巅峰赛" },
                { "key": "carry", "label": "带粉上分" },
                { "key": "official", "label": "官方认证" },
                { "key": "voice", "label": "声优陪玩" }
              ]
            },
            {
              "groupKey": "location",
              "groupLabel": "所在地",
              "isMultiple": false,
              "options": [{ "key": "same_city", "label": "同城" }]
            }
          ]
        }
      }
    }
  ]
}
```

### 接口汇总表

| 序号 | 接口标识 | 方法 | 路径 | 对应数据模型 | 触发时机 | 缓存 |
|------|----------|------|------|--------------|----------|------|
| 1 | getPlayerList | GET | /api/game/player/list | ListData | 初始化/刷新/加载/筛选 | 无 |
| 2 | getFilterConfig | GET | /api/game/player/filter-config | FilterData | 初始化 | 24h |

### 数据库表设计

```sql
-- 用户表（基础信息）
CREATE TABLE users (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT COMMENT '用户ID → userId',
    nickname        VARCHAR(50) NOT NULL COMMENT '昵称 → basicInfo.nickname',
    avatar          VARCHAR(500) COMMENT '头像URL → avatarData.avatarUrl',
    gender          ENUM('male', 'female', 'unknown') DEFAULT 'unknown' COMMENT '性别 → basicInfo.gender',
    age             INT UNSIGNED COMMENT '年龄 → basicInfo.age',
    latitude        DECIMAL(10, 7) COMMENT '纬度',
    longitude       DECIMAL(10, 7) COMMENT '经度',

    is_online       TINYINT(1) DEFAULT 0 COMMENT '是否在线',
    last_active_at  DATETIME COMMENT '最后活跃时间',

    status          TINYINT DEFAULT 1 COMMENT '状态: 0=禁用, 1=正常',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at      DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    INDEX idx_gender (gender),
    INDEX idx_is_online (is_online),
    INDEX idx_location (latitude, longitude),
    INDEX idx_status (status)
) COMMENT '用户表 → PlayerItem.basicInfo';

-- 用户认证表
CREATE TABLE user_certifications (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id         BIGINT NOT NULL COMMENT '用户ID',
    cert_type       VARCHAR(50) NOT NULL COMMENT '认证类型: verified=实名, expert=大神, official=官方',
    cert_status     TINYINT DEFAULT 1 COMMENT '认证状态: 0=失效, 1=有效',
    expired_at      DATETIME COMMENT '过期时间',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,

    UNIQUE KEY uk_user_cert (user_id, cert_type),
    INDEX idx_user_id (user_id),
    INDEX idx_cert_type (cert_type)
) COMMENT '用户认证表 → PlayerItem.certificationData';

-- 用户游戏技能表
CREATE TABLE user_game_skills (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    user_id         BIGINT NOT NULL COMMENT '用户ID',
    game_id         VARCHAR(50) NOT NULL COMMENT '游戏ID: wzry=王者荣耀',

    server_region   VARCHAR(20) COMMENT '大区: qq/wx → gameTagData.serverRegion',
    game_rank       VARCHAR(50) COMMENT '段位 → gameTagData.rank',
    peak_score      VARCHAR(50) COMMENT '巅峰分 → gameTagData.peakScore',
    positions       VARCHAR(200) COMMENT '位置,逗号分隔 → 筛选用',
    description     TEXT COMMENT '技能介绍 → skillData.description',

    price           DECIMAL(10, 2) DEFAULT 0 COMMENT '价格 → priceData.price',
    price_unit      VARCHAR(20) DEFAULT '金币/局' COMMENT '价格单位 → priceData.unit',

    tags            VARCHAR(500) COMMENT '标签,逗号分隔',

    play_count      INT UNSIGNED DEFAULT 0 COMMENT '陪玩次数',
    score           DECIMAL(3, 2) DEFAULT 5.0 COMMENT '评分',

    status          TINYINT DEFAULT 1 COMMENT '状态: 0=下架, 1=上架',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at      DATETIME DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,

    UNIQUE KEY uk_user_game (user_id, game_id),
    INDEX idx_game_id (game_id),
    INDEX idx_server_region (server_region),
    INDEX idx_game_rank (game_rank),
    INDEX idx_price (price),
    INDEX idx_status (status)
) COMMENT '用户游戏技能表 → PlayerItem.gameTagData/skillData/priceData';

-- 游戏配置表（筛选选项配置）
CREATE TABLE game_filter_configs (
    id              BIGINT PRIMARY KEY AUTO_INCREMENT,
    game_id         VARCHAR(50) NOT NULL COMMENT '游戏ID',
    config_type     VARCHAR(50) NOT NULL COMMENT '配置类型: sort/gender/quickTag/filter',
    config_key      VARCHAR(50) NOT NULL COMMENT '配置键',
    config_label    VARCHAR(100) NOT NULL COMMENT '配置显示文案',
    group_key       VARCHAR(50) COMMENT '分组键(filter类型)',
    is_multiple     TINYINT(1) DEFAULT 0 COMMENT '是否多选',
    sort_order      INT DEFAULT 0 COMMENT '排序',
    status          TINYINT DEFAULT 1 COMMENT '状态',
    created_at      DATETIME DEFAULT CURRENT_TIMESTAMP,

    INDEX idx_game_type (game_id, config_type),
    INDEX idx_sort_order (sort_order)
) COMMENT '游戏筛选配置表 → getFilterConfig响应';
```

### 核心SQL查询

```sql
-- 1. 获取陪玩用户列表（返回 STEP 1: PageModel.ListData）
SELECT
    -- PlayerItem.userId
    u.id AS userId,

    -- PlayerItem.avatarData
    u.avatar AS avatarUrl,
    CASE WHEN up.intro_video IS NOT NULL THEN 1 ELSE 0 END AS isVideo,

    -- PlayerItem.basicInfo
    u.nickname,
    u.gender,
    u.age,

    -- PlayerItem.certificationData
    MAX(CASE WHEN uc.cert_type = 'verified' AND uc.cert_status = 1 THEN 1 ELSE 0 END) AS isVerified,
    MAX(CASE WHEN uc.cert_type = 'expert' AND uc.cert_status = 1 THEN 1 ELSE 0 END) AS isExpert,

    -- PlayerItem.skillData
    ugs.description,

    -- PlayerItem.gameTagData
    ugs.server_region AS serverRegion,
    ugs.game_rank AS `rank`,
    ugs.peak_score AS peakScore,

    -- PlayerItem.priceData
    ugs.price,
    ugs.price_unit AS unit,

    -- PlayerItem.locationData (距离计算)
    ROUND(
        ST_Distance_Sphere(
            POINT(u.longitude, u.latitude),
            POINT(#{longitude}, #{latitude})
        ) / 1000, 1
    ) AS distance

FROM users u
INNER JOIN user_game_skills ugs ON u.id = ugs.user_id AND ugs.game_id = #{gameId}
LEFT JOIN user_profiles up ON u.id = up.user_id
LEFT JOIN user_certifications uc ON u.id = uc.user_id AND uc.cert_status = 1
WHERE u.status = 1
  AND ugs.status = 1
  -- 性别筛选
  <if test="genderFilter != 'all'">
  AND u.gender = #{genderFilter}
  </if>
  -- 在线状态筛选
  <if test="filters.onlineStatus">
  AND u.is_online = 1
  </if>
  -- 大区筛选
  <if test="filters.serverRegion != null">
  AND ugs.server_region = #{filters.serverRegion}
  </if>
  -- 段位筛选(多选)
  <if test="filters.ranks != null and filters.ranks.size() > 0">
  AND ugs.game_rank IN
    <foreach collection="filters.ranks" item="rank" open="(" separator="," close=")">
      #{rank}
    </foreach>
  </if>
  -- 价格区间筛选
  <if test="filters.priceRange == '4-9'">
  AND ugs.price >= 4 AND ugs.price <= 9
  </if>
  <if test="filters.priceRange == '10-19'">
  AND ugs.price >= 10 AND ugs.price <= 19
  </if>
  <if test="filters.priceRange == '20+'">
  AND ugs.price >= 20
  </if>
  -- 位置筛选(多选,FIND_IN_SET)
  <if test="filters.positions != null and filters.positions.size() > 0">
  AND (
    <foreach collection="filters.positions" item="pos" separator=" OR ">
      FIND_IN_SET(#{pos}, ugs.positions) > 0
    </foreach>
  )
  </if>
  -- 标签筛选(多选,FIND_IN_SET)
  <if test="filters.tags != null and filters.tags.size() > 0">
  AND (
    <foreach collection="filters.tags" item="tag" separator=" OR ">
      FIND_IN_SET(#{tag}, ugs.tags) > 0
    </foreach>
  )
  </if>
  -- 同城筛选(50km内)
  <if test="filters.sameCity and latitude != null and longitude != null">
  AND ST_Distance_Sphere(
        POINT(u.longitude, u.latitude),
        POINT(#{longitude}, #{latitude})
      ) <= 50000
  </if>
  -- 快捷标签筛选
  <if test="quickTag != null">
  AND FIND_IN_SET(#{quickTag}, ugs.tags) > 0
  </if>
GROUP BY u.id, ugs.id
-- 排序
<choose>
  <when test="sortType == 'smart'">
  ORDER BY u.is_online DESC, ugs.play_count DESC, ugs.score DESC
  </when>
  <when test="sortType == 'newest'">
  ORDER BY ugs.created_at DESC
  </when>
  <when test="sortType == 'recent'">
  ORDER BY u.last_active_at DESC
  </when>
  <when test="sortType == 'popular'">
  ORDER BY ugs.play_count DESC, ugs.score DESC
  </when>
  <otherwise>
  ORDER BY u.is_online DESC, ugs.play_count DESC
  </otherwise>
</choose>
LIMIT #{pageSize} OFFSET #{offset};

-- 2. 获取筛选配置
SELECT
    config_type,
    config_key,
    config_label,
    group_key,
    is_multiple
FROM game_filter_configs
WHERE game_id = #{gameId}
  AND status = 1
ORDER BY config_type, group_key, sort_order;
```

### MVP清单

| 序号 | 功能 | 对应数据模型 | 涉及表 | 接口 | 优先级 |
|------|------|--------------|--------|------|--------|
| 1 | 陪玩列表查询 | ListData | users, user_game_skills, user_certifications | GET /player/list | P0 |
| 2 | 分页支持 | PaginationInfo | - | query params | P0 |
| 3 | 排序功能 | FilterData | - | sortType param | P0 |
| 4 | 性别筛选 | FilterData | users | genderFilter param | P0 |
| 5 | 筛选配置获取 | FilterData | game_filter_configs | GET /filter-config | P0 |
| 6 | 多维度筛选 | FilterConfig | user_game_skills | filters param | P1 |
| 7 | 距离计算 | LocationData | users | latitude/longitude | P1 |
| 8 | 快捷标签筛选 | QuickTagData | user_game_skills | quickTag param | P2 |

**MVP统计：4张表 + 2个接口 = 最小可行后端**

### 性能优化检查点

```
✅ 索引：
   - users.gender 索引（性别筛选）
   - users.is_online 索引（在线状态）
   - users.(latitude, longitude) 索引（距离计算）
   - user_game_skills.game_id 索引（游戏筛选）
   - user_game_skills.server_region 索引（大区筛选）
   - user_game_skills.game_rank 索引（段位筛选）
   - user_game_skills.price 索引（价格筛选）

✅ 冗余：
   - user_game_skills.play_count 陪玩次数（避免COUNT查询）
   - user_game_skills.score 评分（避免AVG查询）

✅ 分页：
   - 使用 LIMIT OFFSET 分页
   - 大数据量时考虑游标分页（基于 id 或 created_at）

✅ 缓存建议：
   - 筛选配置 getFilterConfig 可缓存 24h
   - 热门用户列表可缓存 5分钟
   - 用户详情可缓存 1分钟

✅ 距离计算优化：
   - 使用 MySQL 8.0+ 的 ST_Distance_Sphere
   - 可考虑 GeoHash 预计算区域
```

### 错误码定义

> 接口错误码规范，便于前端统一处理异常情况

#### 通用错误码

| 错误码 | 错误类型 | 说明 | 前端处理 |
|--------|----------|------|----------|
| 200 | 成功 | 请求成功 | 正常处理数据 |
| 400 | 参数错误 | 请求参数不合法 | Toast提示 |
| 401 | 未授权 | 用户未登录或Token过期 | 跳转登录页 |
| 403 | 禁止访问 | 无权限访问 | Toast提示 |
| 500 | 服务器错误 | 服务端内部错误 | Toast"服务繁忙" |
| 502 | 网关错误 | 服务不可用 | Toast"网络异常" |
| 504 | 超时 | 请求超时 | Toast"请求超时" |

#### 业务错误码 - getPlayerList

| 错误码 | 错误类型 | 说明 | 前端处理 |
|--------|----------|------|----------|
| 40001 | INVALID_GAME_ID | 游戏ID无效或不存在 | Toast"游戏不存在" |
| 40002 | INVALID_SORT_TYPE | 排序类型参数错误 | 使用默认排序 |
| 40003 | INVALID_GENDER_FILTER | 性别筛选参数错误 | 使用默认值 |
| 40004 | INVALID_FILTER_PARAMS | 筛选参数格式错误 | Toast"筛选条件有误" |
| 40005 | INVALID_PAGE_PARAMS | 分页参数错误 | 使用默认分页 |
| 40006 | LOCATION_REQUIRED | 同城筛选需要位置权限 | 引导开启位置 |

#### 业务错误码 - getFilterConfig

| 错误码 | 错误类型 | 说明 | 前端处理 |
|--------|----------|------|----------|
| 40010 | GAME_CONFIG_NOT_FOUND | 游戏筛选配置不存在 | 使用默认配置 |
| 40011 | CONFIG_EXPIRED | 配置已过期 | 重新请求 |

#### 错误响应示例

```json
{
  "code": 40001,
  "message": "游戏ID无效",
  "data": null,
  "timestamp": 1701590400000,
  "traceId": "abc123def456"
}
```

#### 前端错误处理建议

```typescript
// 统一错误处理
const handleApiError = (error: ApiError) => {
  switch (error.code) {
    case 401:
      // 跳转登录
      router.push('/login');
      break;
    case 40006:
      // 引导开启位置
      showLocationPermissionDialog();
      break;
    default:
      // 显示错误提示
      Toast.show(error.message || '请求失败');
  }
};
```

---

## 📱 首页关联功能

### 与首页"限时专享"区的关系

首页的"限时专享 优质陪玩"区域展示精选陪玩用户：

| 对比维度 | 首页限时专享 | 本页列表 |
|----------|--------------|----------|
| 数据来源 | 共用`getPlayerList`接口 | 同接口 |
| 筛选条件 | `featured=true` | 用户自选筛选 |
| 展示数量 | 3-5个精选 | 分页加载全部 |
| 卡片标签 | "近期89人下单"、"距离你最近" | 无促销标签 |

### 与首页底部列表的关系

首页底部的陪玩列表是跨游戏综合列表：

| 对比维度 | 首页底部列表 | 本页列表 |
|----------|--------------|----------|
| 游戏范围 | 全游戏 | 仅王者荣耀 |
| Tab选项 | 附近/推荐/最新 | 同样逻辑可复用 |
| 筛选维度 | 区域/筛选（通用） | 大区/段位/位置（游戏专属） |
| 状态显示 | 在线/可预约/离线 | 同样状态系统 |

### 可扩展功能（从首页模式推断）

| 功能 | 首页体现 | 扩展建议 |
|------|----------|----------|
| 视频卡片 | "请你们看雪"视频预览 | PlayerItem支持视频封面+播放 |
| 热度标签 | "近期89人下单" | 可增加订单量/评分标签 |
| 距离排序 | "距离你最近"标签 | 已支持，确保一致性 |

---

## 🎯 质量评估

| 维度 | 评分 | 说明 |
|------|------|------|
| 数据模型 | 9 | PageModel/ItemModel完整，字段与UI绑定清晰，包含4个弹窗组件数据 |
| 结构完整性 | 9 | 所有可见元素均有层级标注，包含筛选面板7个分组 |
| 数据绑定 | 9 | 所有动态数据均有[data:字段]标注 |
| 位置精确度 | 9 | 九宫格+行列系统完整，含详细尺寸，筛选面板布局详尽 |
| 组件拆分 | 9 | L1/L2/L3/L4层级清晰，弹窗组件独立设计 |
| 复用标记 | 9 | 模板和实例标记完整，Badge组件可跨页面复用 |
| 交互描述 | 9.5 | 排序/性别/筛选面板/快捷标签切换流程完整，**新增状态机视图+交互速查表** |
| 代码映射 | 9 | 可直接创建文件夹结构，弹窗组件分离清晰 |
| 接口+后端 | 9.5 | 接口对应数据模型，SQL支持复杂筛选，**新增错误码定义** |
| 可维护性 | 9 | **新增变更影响矩阵**，便于需求迭代评估 |

**综合评分：9.2 / 10**

### v2.0 优化内容

| 优化项 | 位置 | 说明 |
|--------|------|------|
| 变更影响矩阵 | 文档开头 | 评估需求变更的影响范围 |
| 状态机视图 | STEP 2 末尾 | 补充复杂交互的状态转换 |
| 交互速查表 | STEP 3 末尾 | 快速查阅组件交互行为 |
| 错误码定义 | STEP 6 末尾 | 接口错误码规范 |

### v2.1 优化内容

| 优化项 | 位置 | 说明 |
|--------|------|------|
| 页面入口与导航上下文 | 文档开头 | 描述从首页进入的路径和携带数据 |
| 更新初始化流程 | STEP 2 | 增加入口来源和继承数据说明 |
| 首页关联功能 | STEP 6 后 | 说明与首页限时专享/底部列表的关系 |

---

*文档生成时间：2025-12-03*
*模板版本：v5.5*
*文档版本：v2.1*
