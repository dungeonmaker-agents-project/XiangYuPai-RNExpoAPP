# Order è®¢å•æ”¯ä»˜æ¨¡å—å¿«é€Ÿç†è§£

## ğŸ“Œ æ ¸å¿ƒå®šä½
å‘å¨±æ‹ React Native App çš„**è®¢å•ç¡®è®¤æ”¯ä»˜æ¨¡å—**ï¼Œå¤„ç†æŠ€èƒ½æœåŠ¡ä¸‹å•ã€æ”¯ä»˜å¯†ç éªŒè¯ã€æ”¯ä»˜æˆåŠŸæµç¨‹ã€‚

**æŠ€æœ¯æ ˆ**: React Native + Expo Router + TypeScript

## ğŸ¯ ä¸»è¦åŠŸèƒ½
- **è®¢å•ç¡®è®¤**ï¼ˆé™ªç©å¸ˆä¿¡æ¯+æœåŠ¡ä¿¡æ¯+æ•°é‡é€‰æ‹©+ä»·æ ¼é¢„è§ˆï¼‰
- **æ”¯ä»˜å¯†ç éªŒè¯**ï¼ˆ6ä½å¯†ç è¾“å…¥+æ•°å­—é”®ç›˜+éœ‡åŠ¨åé¦ˆï¼‰
- **æ”¯ä»˜æˆåŠŸå±•ç¤º**ï¼ˆè®¢å•å·+å‰©ä½™ä½™é¢+è·³è½¬è®¢å•åˆ—è¡¨ï¼‰

## ğŸ“ æ ¸å¿ƒç›®å½•ç»“æ„
```
Order/
â”œâ”€â”€ index.ts                      # æ¨¡å—å¯¼å‡º
â”œâ”€â”€ types.ts                      # ç±»å‹å®šä¹‰
â”œâ”€â”€ constants.ts                  # å¸¸é‡é…ç½®
â”œâ”€â”€ å¿«é€Ÿç†è§£.md                   # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ api/
â”‚   â””â”€â”€ orderApi.ts               # è®¢å•ç¡®è®¤ APIï¼ˆå¯¹æ¥ BFFï¼‰
â”‚
â”œâ”€â”€ OrderConfirmPage/             # ğŸ“± è®¢å•ç¡®è®¤é¡µ
â”‚   â”œâ”€â”€ index.tsx                 # ä¸»é¡µé¢
â”‚   â”œâ”€â”€ types.ts                  # é¡µé¢ç±»å‹
â”‚   â””â”€â”€ constants.ts              # é¡µé¢å¸¸é‡
â”‚
â”œâ”€â”€ PasswordModal/                # ğŸ” æ”¯ä»˜å¯†ç å¼¹çª—
â”‚   â”œâ”€â”€ index.tsx                 # å¼¹çª—ç»„ä»¶
â”‚   â””â”€â”€ types.ts                  # ç»„ä»¶ç±»å‹
â”‚
â””â”€â”€ PaymentSuccessPage/           # âœ… æ”¯ä»˜æˆåŠŸé¡µ
    â”œâ”€â”€ index.tsx                 # æˆåŠŸé¡µé¢
    â””â”€â”€ types.ts                  # é¡µé¢ç±»å‹
```

## ğŸ—ºï¸ é¡µé¢å¯¼èˆªæµç¨‹

### é¡µé¢æ¸…å•
| é¡µé¢ | è·¯ç”± | ç»„ä»¶ | çŠ¶æ€ |
|------|------|------|------|
| **è®¢å•ç¡®è®¤** | `/order/confirm` | `OrderConfirmPage` | âœ… å·²å®ç° |
| **æ”¯ä»˜æˆåŠŸ** | `/order/payment-success` | `PaymentSuccessPage` | âœ… å·²å®ç° |

### è·³è½¬å…³ç³»å›¾
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Order æ¨¡å—å¯¼èˆªæµç¨‹                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

  ServiceDetailPage
  æœåŠ¡è¯¦æƒ…é¡µ
       â”‚
       â”‚ ç‚¹å‡»"ä¸‹å•"æŒ‰é’®
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /order/confirm  â”‚
â”‚ OrderConfirmPageâ”‚
â”‚   è®¢å•ç¡®è®¤é¡µ     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ ç‚¹å‡»"ç¡®è®¤æ”¯ä»˜"
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PasswordModal  â”‚  â† å¼¹çª—ç»„ä»¶
â”‚  æ”¯ä»˜å¯†ç å¼¹çª—    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â”‚ è¾“å…¥6ä½å¯†ç ï¼ŒéªŒè¯é€šè¿‡
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ /order/payment-successâ”‚
â”‚  PaymentSuccessPage   â”‚
â”‚    æ”¯ä»˜æˆåŠŸé¡µ          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
     â”Œâ”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”
     â”‚           â”‚
     â†“           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚æŸ¥çœ‹è®¢å•  â”‚ â”‚ è¿”å›é¦–é¡µ  â”‚
â”‚/profile/ â”‚ â”‚/(tabs)/  â”‚
â”‚my-orders â”‚ â”‚home      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”‘ æ ¸å¿ƒæ¥å£

### è®¢å•ç¡®è®¤ APIï¼ˆå¯¹æ¥ BFFï¼‰
| æ¥å£ | è¯´æ˜ | å‚æ•° |
|------|------|------|
| `GET /api/app/order/confirm-preview` | è·å–è®¢å•ç¡®è®¤é¢„è§ˆ | serviceId, quantity |
| `GET /api/app/order/preview-update` | æ›´æ–°ä»·æ ¼é¢„è§ˆ | serviceId, quantity |
| `POST /api/app/order/submit-with-payment` | æäº¤è®¢å•å¹¶æ”¯ä»˜ | serviceId, quantity, totalAmount, paymentPassword |
| `GET /api/app/order/balance` | è·å–ç”¨æˆ·ä½™é¢ | - |

## ğŸ›ï¸ æ•°æ®æµå‘
```
ç”¨æˆ·æ“ä½œ
    â†“
OrderConfirmPage (è·å–é¢„è§ˆæ•°æ®)
    â†“ orderConfirmApi.getOrderConfirmPreview
BFF: OrderConfirmController
    â†“ RPC è°ƒç”¨
xypai-user (æœåŠ¡è¯¦æƒ…) + xypai-payment (ä½™é¢)
    â†“
è¿”å›é¢„è§ˆæ•°æ®
    â†“
ç”¨æˆ·ç‚¹å‡»æ”¯ä»˜ â†’ PasswordModal
    â†“
è¾“å…¥å¯†ç  â†’ orderConfirmApi.submitOrderWithPayment
    â†“ RPC è°ƒç”¨
xypai-payment (éªŒè¯å¯†ç ) + xypai-order (åˆ›å»ºè®¢å•+æ‰£æ¬¾)
    â†“
æ”¯ä»˜æˆåŠŸ â†’ PaymentSuccessPage
```

## ğŸ”¥ æŠ€æœ¯äº®ç‚¹

1. **æ”¯ä»˜å¯†ç å¼¹çª—**ï¼šAnimated.spring åŠ¨ç”» + 6ä½å¯†ç æ¡† + æ•°å­—é”®ç›˜ + expo-haptics éœ‡åŠ¨åé¦ˆ
2. **é˜²è¯¯æ“ä½œ**ï¼šæ”¯ä»˜æˆåŠŸé¡µç¦ç”¨è¿”å›æ‰‹åŠ¿ï¼Œä½¿ç”¨ router.replace é˜²æ­¢åé€€
3. **ä¹è§‚æ›´æ–°**ï¼šæ•°é‡å˜åŒ–æ—¶å‰ç«¯ç›´æ¥è®¡ç®—ä»·æ ¼ï¼Œæ— éœ€è°ƒç”¨åç«¯
4. **å…«æ®µå¼æ¶æ„**ï¼šéµå¾ª UNIVERSAL_COMPONENT_ARCHITECTURE_CORE v2.5 æ ‡å‡†

## ğŸ”— ç›¸å…³æ¨¡å—
- [ServiceDetailPage](../Homepage/ServiceFlow/ServiceDetailPage/å¿«é€Ÿç†è§£.md) - å…¥å£é¡µé¢ï¼ˆä¸‹å•æŒ‰é’®ï¼‰
- [xypai-app-bff](../../../../RuoYi-Cloud-Plus/xypai-aggregation/xypai-app-bff/å¿«é€Ÿç†è§£.md) - åç«¯ BFF å±‚

## ğŸš€ å¿«é€Ÿå¯åŠ¨
```typescript
// ä» ServiceDetailPage è·³è½¬åˆ°è®¢å•ç¡®è®¤é¡µ
import { router } from 'expo-router';

const handleOrder = () => {
  router.push({
    pathname: '/order/confirm',
    params: { serviceId: serviceId.toString() }
  });
};
```

## ğŸ“Œ æ³¨æ„äº‹é¡¹

### è·¯ç”±é…ç½®
- éœ€è¦åœ¨ `app/order/confirm.tsx` åˆ›å»ºè·¯ç”±å…¥å£æ–‡ä»¶
- éœ€è¦åœ¨ `app/order/payment-success.tsx` åˆ›å»ºè·¯ç”±å…¥å£æ–‡ä»¶

### å®‰å…¨è€ƒè™‘
- æ”¯ä»˜å¯†ç åœ¨å‰ç«¯åªåšæ ¼å¼æ ¡éªŒï¼ˆ6ä½æ•°å­—ï¼‰
- å®é™…éªŒè¯åœ¨åç«¯ xypai-payment æœåŠ¡å®Œæˆ
- é”™è¯¯3æ¬¡é”å®š30åˆ†é’Ÿ

---
**æœ€åæ›´æ–°**: 2025-12-04
